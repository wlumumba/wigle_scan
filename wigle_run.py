import os
from pathlib import Path
from os.path import join
import json

import argparse
import pandas as pd

from utils import Logger, WigleAPI, NetParser, GoogleAPI
from create_sketch import create_a_sketch

Logger.create()
log = Logger.getLogger()

# ------------------------------------------------------
# Fetch Wigle data and Create ESP Files
# ------------------------------------------------------
def fetch_wigle_api(jobs_file):
    """Fetches Wigle data from API"""
    net_parser = NetParser()
    wigle = WigleAPI()

    # Opening the jobs CSV file
    try:
        log.info(f"opening: {jobs_file} file.")
        jobs_path = os.path.join(os.path.dirname(__file__), jobs_file)
        jobs = pd.read_csv(jobs_path)

        jobs["comment"] = jobs["comment"].fillna("").astype("str")
    except Exception as e:
        log.critical(f"{str(e)}")
        return

    for i, job in jobs.iterrows():
        # Skip all rows starting with 0's
        try:
            if int(job["run"]) == 0:
                continue
        except Exception as e:
            log.warn("Failed to read row. You may have extra rows in your CSV file.")
            continue  # failed to read 'run' value

        log.info(
            "Fetching data for lat: {lat}, long: {lon}, since: {since}, radius: {radius}".format(
                **job
            )
        )

        # Fetch data from Wigle API and sort by distance
        url = wigle.build_url(job.lat, job.lon, job.radius, job.since)
        networks = wigle.fetch(url, job.lat, job.lon)
        if not networks:
           log.info("No networks found for provided coordinates.")
           return
        networks = net_parser.sort_distance(networks, "wigle")

        # TO TEST NETWORKS LIST ##
        # networks = [
        #     {
        #         "ssid": "ARRIS-E5C7-5G",
        #         "bssid": "60:D2:48:F1:19:D4",
        #         "channel": 161,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77416611,
        #         "lon": -80.1404953,
        #         "distance_x": -2.8788485974416234,
        #         "distance_y": -6.634886338597061,
        #         "distance_xy": -7.232529995309406,
        #     },
        #     {
        #         "ssid": "DP Kitchen",
        #         "bssid": "20:6A:94:DB:B2:C8",
        #         "channel": 6,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77429581,
        #         "lon": -80.14052582,
        #         "distance_x": 0.1825611299853755,
        #         "distance_y": 7.733869083856121,
        #         "distance_xy": 7.736023498183161,
        #     },
        #     {
        #         "ssid": "WAG_5",
        #         "bssid": "90:A7:C1:81:71:ED",
        #         "channel": 157,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77419662,
        #         "lon": -80.1403656,
        #         "distance_x": -15.888836857925707,
        #         "distance_y": -3.254849908624689,
        #         "distance_xy": -16.218793012993352,
        #     },
        #     {
        #         "ssid": "ATTRCmqp5S",
        #         "bssid": "86:8F:CF:79:9C:A3",
        #         "channel": 36,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77435875,
        #         "lon": -80.140625,
        #         "distance_x": 10.13113966304315,
        #         "distance_y": 14.706648407531992,
        #         "distance_xy": 17.858482131847932,
        #     },
        #     {
        #         "ssid": "ipet",
        #         "bssid": "04:62:73:B4:EA:EF",
        #         "channel": 64,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77431297,
        #         "lon": -80.14037323,
        #         "distance_x": -15.12348442606909,
        #         "distance_y": 9.63493188666341,
        #         "distance_xy": -17.931857877793515,
        #     },
        #     {
        #         "ssid": "Theatro",
        #         "bssid": "22:3F:1B:57:71:2A",
        #         "channel": 52,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77420425,
        #         "lon": -80.14070129,
        #         "distance_x": 17.783660899104376,
        #         "distance_y": -2.409563837122218,
        #         "distance_xy": -17.94615977129032,
        #     },
        #     {
        #         "ssid": "908-B",
        #         "bssid": "74:3E:2B:11:6E:38",
        #         "channel": 8,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77439499,
        #         "lon": -80.14038849,
        #         "distance_x": -13.592779560930342,
        #         "distance_y": 18.721480380887847,
        #         "distance_xy": -23.135626685950566,
        #     },
        #     {
        #         "ssid": "DENON_6CAB47C91408CBF0C0631F10D3",
        #         "bssid": "00:05:CD:99:DA:53",
        #         "channel": 153,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77430153,
        #         "lon": -80.14030457,
        #         "distance_x": -22.010653230272936,
        #         "distance_y": 8.367556684037234,
        #         "distance_xy": -23.54749570000241,
        #     },
        #     {
        #         "ssid": "PetcoCare",
        #         "bssid": "04:62:73:B4:EA:E6",
        #         "channel": 11,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77435303,
        #         "lon": -80.14071655,
        #         "distance_x": 19.3143657628175,
        #         "distance_y": 14.072960801804097,
        #         "distance_xy": 23.897542831241996,
        #     },
        #     {
        #         "ssid": "ARRIS-8133",
        #         "bssid": "84:BB:69:AA:E3:1C",
        #         "channel": 11,
        #         "rssi": -50,
        #         "qos": 3,
        #         "lat": 25.77418709,
        #         "lon": -80.14028931,
        #         "distance_x": -23.541358093985878,
        #         "distance_y": -4.310626612098195,
        #         "distance_xy": -23.932764642735304,
        #     },
        #     {
        #         "ssid": "Sonos",
        #         "bssid": "B4:FB:E4:14:4E:73",
        #         "channel": 1,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77443314,
        #         "lon": -80.14044189,
        #         "distance_x": -8.236315620438756,
        #         "distance_y": 22.94791085958423,
        #         "distance_xy": -24.381209774239704,
        #     },
        #     {
        #         "ssid": "PetcoStore",
        #         "bssid": "04:62:73:C5:7A:7D",
        #         "channel": 153,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77428436,
        #         "lon": -80.14076233,
        #         "distance_x": 23.906480355381962,
        #         "distance_y": 6.465386038670783,
        #         "distance_xy": 24.765313243128304,
        #     },
        #     {
        #         "ssid": "Theatro",
        #         "bssid": "22:3F:1B:57:73:24",
        #         "channel": 56,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77437973,
        #         "lon": -80.14070892,
        #         "distance_x": 18.549013330960943,
        #         "distance_y": 17.030908195153447,
        #         "distance_xy": 25.18168553041003,
        #     },
        #     {
        #         "ssid": "3201 Main",
        #         "bssid": "D4:C1:9E:3E:61:AC",
        #         "channel": 44,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77444267,
        #         "lon": -80.14042664,
        #         "distance_x": -9.766017401646963,
        #         "distance_y": 24.00368759862313,
        #         "distance_xy": -25.914319227530214,
        #     },
        #     {
        #         "ssid": "PetcoCare",
        #         "bssid": "04:62:73:C5:7A:79",
        #         "channel": 153,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77444077,
        #         "lon": -80.14039612,
        #         "distance_x": -12.827427129073687,
        #         "distance_y": 23.79319695790453,
        #         "distance_xy": -27.030701286765733,
        #     },
        #     {
        #         "ssid": "PetcoGuests",
        #         "bssid": "04:62:73:C5:7A:7E",
        #         "channel": 153,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77427292,
        #         "lon": -80.14079285,
        #         "distance_x": 26.967890082807553,
        #         "distance_y": 5.198010841588939,
        #         "distance_xy": 27.464269993075547,
        #     },
        #     {
        #         "ssid": "ipet",
        #         "bssid": "04:62:73:C5:7A:70",
        #         "channel": 1,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77433395,
        #         "lon": -80.14027405,
        #         "distance_x": -25.07206295769874,
        #         "distance_y": 11.959191659519691,
        #         "distance_xy": -27.778229558417465,
        #     },
        #     {
        #         "ssid": "spectra",
        #         "bssid": "04:62:73:C5:7A:7F",
        #         "channel": 153,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77437592,
        #         "lon": -80.14029694,
        #         "distance_x": -22.776005662129414,
        #         "distance_y": 16.608819071742843,
        #         "distance_xy": -28.18862630602322,
        #     },
        #     {
        #         "ssid": "Sonos",
        #         "bssid": "BE:FB:E4:14:4E:73",
        #         "channel": 1,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77415085,
        #         "lon": -80.14024353,
        #         "distance_x": -28.133472685124218,
        #         "distance_y": -8.325458470234157,
        #         "distance_xy": -29.33949628987345,
        #     },
        #     {
        #         "ssid": "416298-2.4",
        #         "bssid": "60:3D:26:41:62:9C",
        #         "channel": 11,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77443695,
        #         "lon": -80.14032745,
        #         "distance_x": -19.715599017208607,
        #         "distance_y": 23.369999985511818,
        #         "distance_xy": -30.575497651764305,
        #     },
        #     {
        #         "ssid": "Daniela-5",
        #         "bssid": "E0:DB:D1:6E:5B:E8",
        #         "channel": 153,
        #         "rssi": -50,
        #         "qos": 0,
        #         "lat": 25.77449799,
        #         "lon": -80.14046478,
        #         "distance_x": -5.940258324868584,
        #         "distance_y": 30.132288802383854,
        #         "distance_xy": -30.71223562414444,
        #     },
        #     {
        #         "ssid": "Apt 1608",
        #         "bssid": "60:6C:63:CE:7D:F8",
        #         "channel": 1,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77435875,
        #         "lon": -80.14079285,
        #         "distance_x": 26.967890082807553,
        #         "distance_y": 14.706648407531992,
        #         "distance_xy": 30.717288189397035,
        #     },
        #     {
        #         "ssid": "ICON  PUBLIC",
        #         "bssid": "BE:FB:E4:15:4E:73",
        #         "channel": 48,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77448082,
        #         "lon": -80.14064789,
        #         "distance_x": 12.4271969586132,
        #         "distance_y": 28.230118105628957,
        #         "distance_xy": 30.84435868448792,
        #     },
        #     {
        #         "ssid": "ARRIS-E5C7",
        #         "bssid": "60:D2:48:F1:19:D3",
        #         "channel": 11,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77395248,
        #         "lon": -80.14044952,
        #         "distance_x": -7.470963188582038,
        #         "distance_y": -30.301788022549918,
        #         "distance_xy": -31.209193778087137,
        #     },
        #     {
        #         "ssid": "908-B",
        #         "bssid": "74:3E:2B:11:6E:3C",
        #         "channel": 44,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77435684,
        #         "lon": -80.14024353,
        #         "distance_x": -28.133472685124218,
        #         "distance_y": 14.495049923004437,
        #         "distance_xy": -31.648031369852532,
        #     },
        #     {
        #         "ssid": "PetcoGuests",
        #         "bssid": "04:62:73:C5:7A:71",
        #         "channel": 1,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77444267,
        #         "lon": -80.14031219,
        #         "distance_x": -21.246303880921644,
        #         "distance_y": 24.00368759862313,
        #         "distance_xy": -32.05591407436112,
        #     },
        #     {
        #         "ssid": "mgc-5G",
        #         "bssid": "84:BB:69:AA:CF:94",
        #         "channel": 48,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77447319,
        #         "lon": -80.14035034,
        #         "distance_x": -17.41954172163891,
        #         "distance_y": 27.384832002929382,
        #         "distance_xy": -32.45564402264028,
        #     },
        #     {
        #         "ssid": "HF\x05LPD100",
        #         "bssid": "34:EA:E7:B1:17:4F",
        #         "channel": 4,
        #         "rssi": -50,
        #         "qos": 0,
        #         "lat": 25.77451897,
        #         "lon": -80.14057159,
        #         "distance_x": 4.773672638620647,
        #         "distance_y": 32.45654863486443,
        #         "distance_xy": 32.80572272914631,
        #     },
        #     {
        #         "ssid": "Ron WiFi",
        #         "bssid": "1A:E8:29:C5:E6:1B",
        #         "channel": 44,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77404022,
        #         "lon": -80.14026642,
        #         "distance_x": -25.837415389555144,
        #         "distance_y": -20.581552401391452,
        #         "distance_xy": -33.032913476524165,
        #     },
        #     {
        #         "ssid": "Guest 1902 -5",
        #         "bssid": "08:A7:C0:AB:CB:40",
        #         "channel": 36,
        #         "rssi": -50,
        #         "qos": 4,
        #         "lat": 25.77417374,
        #         "lon": -80.14085388,
        #         "distance_x": 33.089706455152424,
        #         "distance_y": -5.789600271101121,
        #         "distance_xy": -33.59238937805977,
        #     },
        #     {
        #         "ssid": "415A70-5",
        #         "bssid": "60:3D:26:41:5A:7C",
        #         "channel": 157,
        #         "rssi": -50,
        #         "qos": 4,
        #         "lat": 25.7745285,
        #         "lon": -80.14055634,
        #         "distance_x": 3.2439708588378386,
        #         "distance_y": 33.51232538653497,
        #         "distance_xy": 33.668966023,
        #     },
        #     {
        #         "ssid": "HassNetMiami",
        #         "bssid": "D2:7F:54:DA:0B:E1",
        #         "channel": 1,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77451515,
        #         "lon": -80.14064789,
        #         "distance_x": 12.4271969586132,
        #         "distance_y": 32.033351658128204,
        #         "distance_xy": 34.35943056061453,
        #     },
        #     {
        #         "ssid": "ARRIS-4CF4-5G",
        #         "bssid": "2C:58:4F:94:B4:F2",
        #         "channel": 149,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77434921,
        #         "lon": -80.14020538,
        #         "distance_x": -31.960234845830993,
        #         "distance_y": 13.649763834998302,
        #         "distance_xy": -34.75300863722582,
        #     },
        #     {
        #         "ssid": "ICON  PUBLIC",
        #         "bssid": "C2:FB:E4:15:4E:73",
        #         "channel": 48,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77453804,
        #         "lon": -80.14063263,
        #         "distance_x": 10.896492094899843,
        #         "distance_y": 34.56920998470872,
        #         "distance_xy": 36.245875743520905,
        #     },
        #     {
        #         "ssid": "PetcoCare",
        #         "bssid": "04:62:73:C5:7A:76",
        #         "channel": 1,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77440453,
        #         "lon": -80.14021301,
        #         "distance_x": -31.194882413974778,
        #         "distance_y": 19.77836495987793,
        #         "distance_xy": -36.93647185613577,
        #     },
        #     {
        #         "ssid": "Banks Wifi",
        #         "bssid": "6A:8F:2E:77:67:50",
        #         "channel": 161,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77454948,
        #         "lon": -80.14038849,
        #         "distance_x": -13.592779560930342,
        #         "distance_y": 35.83658522862556,
        #         "distance_xy": -38.327848832137846,
        #     },
        #     {
        #         "ssid": "NetGear83!",
        #         "bssid": "B0:6A:41:88:B9:B9",
        #         "channel": 149,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77389145,
        #         "lon": -80.14042664,
        #         "distance_x": -9.766017401646963,
        #         "distance_y": -37.06296848655476,
        #         "distance_xy": -38.32804451410124,
        #     },
        #     {
        #         "ssid": "Ron WiFi",
        #         "bssid": "18:E8:29:C4:E6:1B",
        #         "channel": 1,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77403259,
        #         "lon": -80.14019012,
        #         "distance_x": -33.490939709543326,
        #         "distance_y": -21.4268384531293,
        #         "distance_xy": -39.75870052056285,
        #     },
        #     {
        #         "ssid": "Master bedroom",
        #         "bssid": "5C:A5:BC:03:AC:A5",
        #         "channel": 1,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77459145,
        #         "lon": -80.14056396,
        #         "distance_x": 4.008320206763908,
        #         "distance_y": 40.486212777925495,
        #         "distance_xy": 40.68414933116734,
        #     },
        #     {
        #         "ssid": "ChezLouis",
        #         "bssid": "28:BD:89:C7:05:2E",
        #         "channel": 36,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77406311,
        #         "lon": -80.14015961,
        #         "distance_x": -36.551346354462474,
        #         "distance_y": -18.045694239815607,
        #         "distance_xy": -40.76333922794136,
        #     },
        #     {
        #         "ssid": "PetcoStore",
        #         "bssid": "04:62:73:B4:EA:ED",
        #         "channel": 64,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77406693,
        #         "lon": -80.14089203,
        #         "distance_x": 36.91646861585833,
        #         "distance_y": -17.622497289854632,
        #         "distance_xy": -40.90696618840822,
        #     },
        #     {
        #         "ssid": "Murano 3301 - 2",
        #         "bssid": "CC:F4:11:72:12:90",
        #         "channel": 149,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77459145,
        #         "lon": -80.14058685,
        #         "distance_x": 6.304377503759584,
        #         "distance_y": 40.486212777925495,
        #         "distance_xy": 40.974119624848186,
        #     },
        #     {
        #         "ssid": "mychevroletE510",
        #         "bssid": "62:E6:F0:E4:E5:10",
        #         "channel": 7,
        #         "rssi": -50,
        #         "qos": 0,
        #         "lat": 25.77459526,
        #         "lon": -80.14060974,
        #         "distance_x": 8.600434799329747,
        #         "distance_y": 40.90830191433653,
        #         "distance_xy": 41.80258861962558,
        #     },
        #     {
        #         "ssid": "PetcoStore",
        #         "bssid": "04:62:73:95:54:5D",
        #         "channel": 36,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77446938,
        #         "lon": -80.14020538,
        #         "distance_x": -31.960234845830993,
        #         "distance_y": 26.962742874886853,
        #         "distance_xy": -41.81439980496557,
        #     },
        #     {
        #         "ssid": "PHC Guest",
        #         "bssid": "30:34:22:BE:5B:4C",
        #         "channel": 36,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77385139,
        #         "lon": -80.14044189,
        #         "distance_x": -8.236315620438756,
        #         "distance_y": -41.500997120087526,
        #         "distance_xy": -42.31039907601515,
        #     },
        #     {
        #         "ssid": "Daisy1105-5G",
        #         "bssid": "60:3D:26:44:75:34",
        #         "channel": 149,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77422905,
        #         "lon": -80.14009857,
        #         "distance_x": -42.67416580930967,
        #         "distance_y": 0.3378928610159037,
        #         "distance_xy": -42.67550295607071,
        #     },
        #     {
        #         "ssid": "PAREKH 5G",
        #         "bssid": "90:A7:C1:1A:D3:1D",
        #         "channel": 157,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.7741375,
        #         "lon": -80.14095306,
        #         "distance_x": 43.03828498820021,
        #         "distance_y": -9.804432122897852,
        #         "distance_xy": -44.14093607947443,
        #     },
        #     {
        #         "ssid": "PetcoGuests",
        #         "bssid": "04:62:73:95:54:5E",
        #         "channel": 36,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77449417,
        #         "lon": -80.14019775,
        #         "distance_x": -32.725587277687175,
        #         "distance_y": 29.70909182676193,
        #         "distance_xy": -44.199454664296745,
        #     },
        #     {
        #         "ssid": "ATTepah28T",
        #         "bssid": "08:9B:B9:E2:2A:F4",
        #         "channel": 7,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77443504,
        #         "lon": -80.14013672,
        #         "distance_x": -38.84740365003041,
        #         "distance_y": 23.158401500226777,
        #         "distance_xy": -45.22642685668984,
        #     },
        #     {
        #         "ssid": "TotalWine_Guest",
        #         "bssid": "3A:3F:1B:57:73:24",
        #         "channel": 56,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.7745018,
        #         "lon": -80.14086151,
        #         "distance_x": 33.85505888700857,
        #         "distance_y": 30.55437793239279,
        #         "distance_xy": 45.60408286078759,
        #     },
        #     {
        #         "ssid": "PetcoGuests",
        #         "bssid": "04:62:73:B4:EA:EE",
        #         "channel": 64,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77405548,
        #         "lon": -80.14093781,
        #         "distance_x": 41.50858320699384,
        #         "distance_y": -18.890980294911007,
        #         "distance_xy": -45.60519793701139,
        #     },
        #     {
        #         "ssid": "HartmanSouth",
        #         "bssid": "90:CA:FA:A5:70:3D",
        #         "channel": 36,
        #         "rssi": -50,
        #         "qos": 3,
        #         "lat": 25.77400208,
        #         "lon": -80.14013672,
        #         "distance_x": -38.84740365003041,
        #         "distance_y": -24.806874806880298,
        #         "distance_xy": -46.09234904284906,
        #     },
        #     {
        #         "ssid": "spectra",
        #         "bssid": "04:62:73:95:54:5F",
        #         "channel": 36,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77446365,
        #         "lon": -80.14014435,
        #         "distance_x": -38.08205121817447,
        #         "distance_y": 26.327947414255867,
        #         "distance_xy": -46.296874097983064,
        #     },
        #     {
        #         "ssid": "Gee",
        #         "bssid": "D4:D7:48:21:13:70",
        #         "channel": 157,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77458,
        #         "lon": -80.14027405,
        #         "distance_x": -25.07206295769874,
        #         "distance_y": 39.21772968163972,
        #         "distance_xy": -46.54714596186827,
        #     },
        #     {
        #         "ssid": "Miami",
        #         "bssid": "EC:74:27:F8:14:E6",
        #         "channel": 60,
        #         "rssi": -50,
        #         "qos": 3,
        #         "lat": 25.77464867,
        #         "lon": -80.14048767,
        #         "distance_x": -3.6442010292983684,
        #         "distance_y": 46.82530475381826,
        #         "distance_xy": -46.96689599548477,
        #     },
        #     {
        #         "ssid": "TWM_Vendors",
        #         "bssid": "26:3F:1B:57:73:24",
        #         "channel": 56,
        #         "rssi": -50,
        #         "qos": 7,
        #         "lat": 25.77451515,
        #         "lon": -80.14089203,
        #         "distance_x": 36.91646861585833,
        #         "distance_y": 32.033351658128204,
        #         "distance_xy": 48.87696769023584,
        #     },
        #     {
        #         "ssid": "pv_jr",
        #         "bssid": "B2:6A:41:88:BD:40",
        #         "channel": 1,
        #         "rssi": -55,
        #         "qos": 4,
        #         "lat": 25.7737999,
        #         "lon": -80.14035034,
        #         "distance_x": -17.41954172163891,
        #         "distance_y": -47.20529299923109,
        #         "distance_xy": -50.31680837083064,
        #     },
        #     {
        #         "ssid": "ARRIS-AD20-5G",
        #         "bssid": "60:D2:48:F6:0C:8B",
        #         "channel": 161,
        #         "rssi": -55,
        #         "qos": 7,
        #         "lat": 25.77401924,
        #         "lon": -80.14007568,
        #         "distance_x": -44.97022310630226,
        #         "distance_y": -22.905812080839816,
        #         "distance_xy": -50.467818438700334,
        #     },
        #     {
        #         "ssid": "TWM_Vendors",
        #         "bssid": "26:3F:1B:57:71:2A",
        #         "channel": 52,
        #         "rssi": -55,
        #         "qos": 7,
        #         "lat": 25.77441597,
        #         "lon": -80.14098358,
        #         "distance_x": 46.0996947156229,
        #         "distance_y": 21.045740179785632,
        #         "distance_xy": 50.67644076545915,
        #     },
        #     {
        #         "ssid": "Loco Layla-5G",
        #         "bssid": "D4:E2:CB:03:1E:28",
        #         "channel": 149,
        #         "rssi": -55,
        #         "qos": 3,
        #         "lat": 25.77402496,
        #         "lon": -80.14006805,
        #         "distance_x": -45.73557553815789,
        #         "distance_y": -22.272124504572734,
        #         "distance_xy": -50.870363909980256,
        #     },
        #     {
        #         "ssid": "RSSI",
        #         "bssid": "2E:3F:1B:57:73:24",
        #         "channel": 56,
        #         "rssi": -55,
        #         "qos": 7,
        #         "lat": 25.77454567,
        #         "lon": -80.14089966,
        #         "distance_x": 37.68182104771434,
        #         "distance_y": 35.414496095220294,
        #         "distance_xy": 51.7117236867882,
        #     },
        #     {
        #         "ssid": "PetcoCare",
        #         "bssid": "04:62:73:95:54:59",
        #         "channel": 36,
        #         "rssi": -55,
        #         "qos": 7,
        #         "lat": 25.77452087,
        #         "lon": -80.14011383,
        #         "distance_x": -41.143460945598065,
        #         "distance_y": 32.6670392773965,
        #         "distance_xy": -52.5348993534935,
        #     },
        #     {
        #         "ssid": "Ron WiFi",
        #         "bssid": "18:E8:29:C4:B3:AB",
        #         "channel": 11,
        #         "rssi": -55,
        #         "qos": 7,
        #         "lat": 25.7740097,
        #         "lon": -80.1400528,
        #         "distance_x": -47.2652773179384,
        #         "distance_y": -23.96269660374944,
        #         "distance_xy": -52.99265343911967,
        #     },
        #     {
        #         "ssid": "DIRECT-F6-HP ENVY 4510 series",
        #         "bssid": "DC:4A:3E:B7:42:F7",
        #         "channel": 1,
        #         "rssi": -55,
        #         "qos": 6,
        #         "lat": 25.77378273,
        #         "lon": -80.14029694,
        #         "distance_x": -22.776005662129414,
        #         "distance_y": -49.107463513376075,
        #         "distance_xy": -54.13216542803895,
        #     },
        #     {
        #         "ssid": "scratchie",
        #         "bssid": "98:ED:7E:B1:BC:07",
        #         "channel": 1,
        #         "rssi": -55,
        #         "qos": 7,
        #         "lat": 25.77391052,
        #         "lon": -80.14093781,
        #         "distance_x": 41.50858320699384,
        #         "distance_y": -34.95030731854612,
        #         "distance_xy": -54.26316446219349,
        #     },
        #     {
        #         "ssid": "MuranoDH",
        #         "bssid": "A0:FF:70:90:C0:90",
        #         "channel": 11,
        #         "rssi": -55,
        #         "qos": 7,
        #         "lat": 25.77395058,
        #         "lon": -80.14007568,
        #         "distance_x": -44.97022310630226,
        #         "distance_y": -30.51227864900728,
        #         "distance_xy": -54.344500946152074,
        #     },
        #     {
        #         "ssid": "ARRIS-5666-5G",
        #         "bssid": "70:4F:B8:FF:06:D5",
        #         "channel": 157,
        #         "rssi": -55,
        #         "qos": 7,
        #         "lat": 25.77458382,
        #         "lon": -80.14092255,
        #         "distance_x": 39.97787834328215,
        #         "distance_y": 39.640926662106594,
        #         "distance_xy": 56.29945852474231,
        #     },
        #     {
        #         "ssid": "VTECH_901HD_e984",
        #         "bssid": "A6:97:5C:AA:E9:84",
        #         "channel": 1,
        #         "rssi": -55,
        #         "qos": 0,
        #         "lat": 25.77466393,
        #         "lon": -80.14081573,
        #         "distance_x": 29.26294429587131,
        #         "distance_y": 48.515877002088374,
        #         "distance_xy": 56.657806936740414,
        #     },
        #     {
        #         "ssid": "ATTJY4xbn2",
        #         "bssid": "B4:63:6F:1D:B3:AC",
        #         "channel": 132,
        #         "rssi": -55,
        #         "qos": 0,
        #         "lat": 25.77466393,
        #         "lon": -80.14081573,
        #         "distance_x": 29.26294429587131,
        #         "distance_y": 48.515877002088374,
        #         "distance_xy": 56.657806936740414,
        #     },
        #     {
        #         "ssid": "Management",
        #         "bssid": "CA:FB:E4:15:44:5A",
        #         "channel": 153,
        #         "rssi": -55,
        #         "qos": 3,
        #         "lat": 25.77461624,
        #         "lon": -80.14089966,
        #         "distance_x": 37.68182104771434,
        #         "distance_y": 43.232561777322694,
        #         "distance_xy": 57.349536972161445,
        #     },
        #     {
        #         "ssid": "Yvonne",
        #         "bssid": "E8:9F:80:B0:70:9A",
        #         "channel": 4,
        #         "rssi": -55,
        #         "qos": 7,
        #         "lat": 25.77377892,
        #         "lon": -80.14022064,
        #         "distance_x": -30.42952998211853,
        #         "distance_y": -49.529552601242266,
        #         "distance_xy": -58.130339287195376,
        #     },
        #     {
        #         "ssid": "RRFLA 5G",
        #         "bssid": "6A:8F:2E:75:AA:60",
        #         "channel": 48,
        #         "rssi": -55,
        #         "qos": 7,
        #         "lat": 25.77375603,
        #         "lon": -80.14006042,
        #         "distance_x": -46.50092797001349,
        #         "distance_y": -52.065410663846215,
        #         "distance_xy": -69.80796378143224,
        #     },
        # ]

        # Validate data using Google API
        google = GoogleAPI(networks)
        first_valid = google.get_first_valid_network()
        validated_networks = google.validate_networks(first_valid)

        # Publish data to JSON file(s)
        original_dict = net_parser.publish_json(networks, job.filename, job)
        
        if validated_networks:
            validated_dict = net_parser.publish_json(validated_networks, f"{job.filename}-validated", job)

        # Convert data to ESP files
        create_a_sketch(original_dict)
        create_a_sketch(validated_dict) if validated_networks else None
       

# ------------------------------------------------------
# Entry
# ------------------------------------------------------
def main():
    # Create the parser
    parser = argparse.ArgumentParser(description="Queries the wigle database.")

    # Add arguments
    parser.add_argument(
        "-j",
        "--jobs",
        type=str,
        help="CSV File name to the list of locations to query",
        required=True,
    )

    # Parse arguments
    args = parser.parse_args()

    fetch_wigle_api(args.jobs)


if __name__ == "__main__":
    main()
